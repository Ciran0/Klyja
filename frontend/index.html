<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>klyja - Spherical Map Animation</title>
        <link rel="stylesheet" href="/css/styles.css">
        <script type="importmap">
    {
        "imports": {
            "three": "https://unpkg.com/three@0.163.0/build/three.module.js",
            "three/addons/": "https://unpkg.com/three@0.163.0/examples/jsm/"
        }
    }
        </script>
        <script type="module" src="/js/main.js"></script>
        <style>
        body { display: flex; flex-direction: column; height: 100vh; margin: 0; font-family: sans-serif; }
        .main-content { display: flex; flex: 1; overflow: hidden; height: 100%}
        #viewer-container { flex-grow: 1; border-right: 1px solid #ccc; min-width: 300px; }
        #controls-panel { width: 300px; padding: 15px; overflow-y: auto; font-size: 0.9em; }
        #controls-panel h3, #controls-panel h4 { margin-top: 15px; margin-bottom: 5px; }
        #controls-panel label, #controls-panel input, #controls-panel button, #controls-panel select, #controls-panel a.button { display: block; margin-bottom: 8px; width: 95%; box-sizing: border-box; }
        #controls-panel input[type="number"] { width: 100px; }
        .status-message { margin-top: 15px; font-style: italic; color: #555; }
        hr { margin: 15px 0; }
        #user-info-panel, #my-animations-panel { margin-bottom: 15px; }
        #logout-button, a.button {
            background-color: #f0f0f0; border: 1px solid #ccc; border-radius: 4px; padding: 8px;
            text-align: center; color: black; text-decoration: none; cursor: pointer;
        }
        #my-animations-list { list-style-type: none; padding: 0; }
        #my-animations-list li { padding: 5px; cursor: pointer; border-radius: 3px; }
        #my-animations-list li:hover { background-color: #e9e9e9; }
        .hidden { display: none; }
        </style>
    </head>
    <body>
        <div class="main-content">
            <div id="viewer-container"></div>
            <aside id="controls-panel">
                <div id="user-auth-panel">
                    <div id="user-info-panel" class="hidden">
                        <p>
                            Welcome, <strong id="user-display-name"></strong>!
                        </p>
                        <button id="logout-button">Logout</button>
                    </div>
                    <div id="login-panel">
                        <a href="/api/auth/github" class="button">Login with GitHub</a>
                    </div>
                </div>
                <hr>
                <div id="my-animations-panel" class="hidden">
                    <h3>My Animations</h3>
                    <ul id="my-animations-list">
                    </ul>
                </div>
                <h3>Animation Settings</h3>
                <label for="anim-name-input">Animation Name:</label>
                <input type="text" id="anim-name-input" placeholder="Untitled Animation">
                <p style="font-size: 0.9em;">
                    WASM Name: <span id="wasm-name-span">Loading...</span>
                </p>
                <label for="total-frames-input">Total Frames:</label>
                <input type="number" id="total-frames-input" value="100" min="1">
                <button id="set-total-frames-button">Set Total Frames</button>
                <hr>
                <h3>Timeline</h3>
                <label for="frame-slider">
                    Current Frame: <span id="current-frame-display">0</span> / <span id="max-frame-display">100</span>
                </label>
                <input type="range"
                       id="frame-slider"
                       min="0"
                       value="0"
                       max="100"
                       style="width: 100%">
                <hr>
                <h3>Feature Management</h3>
                <h4>Features in Animation</h4>
                <ul id="feature-list"
                    style="height: 100px;
                           overflow-y: auto;
                           border: 1px solid #ccc;
                           padding: 5px;
                           list-style-type: none;
                           margin:0">
                </ul>
                <h4>Points in Active Feature</h4>
                <ul id="point-list"
                    style="height: 100px;
                           overflow-y: auto;
                           border: 1px solid #ccc;
                           padding: 5px;
                           list-style-type: none;
                           margin:0">
                </ul>
                <p>
                    Active Feature: <span id="active-feature-id-display">None</span>
                </p>
                <h4>Add to Active Feature</h4>
                <label for="click-to-add-toggle" style="cursor: pointer;">
                    <input type="checkbox" id="click-to-add-toggle">
                    Click on sphere to add points
                </label>
                <hr style="margin: 5px 0;">
                <label for="point-id-input">Point ID (for keyframing):</label>
                <input type="text" id="point-id-input" placeholder="Select from list above">
                <p>
                    <em>Click Coords: <span id="sphere-click-coords">(x: N/A, y: N/A, z: N/A)</span></em>
                </p>
                <button id="add-keyframe-button">Add Keyframe to Selected Point</button>
                <hr>
                <p>
                    Active Feature ID: <span id="active-feature-id-display">None</span>
                </p>
                <h4>Create New Feature</h4>
                <label for="feature-name-input">Feature Name:</label>
                <input type="text" id="feature-name-input" placeholder="MyContinent">
                <label for="feature-type-select">Type:</label>
                <select id="feature-type-select">
                    <option value="1">Polygon</option>
                    <option value="2">Polyline</option>
                </select>
                <label for="feature-appearance-frame-input">Appearance Frame:</label>
                <input type="number" id="feature-appearance-frame-input" value="0" min="0">
                <label for="feature-disappearance-frame-input">Disappearance Frame:</label>
                <input type="number"
                       id="feature-disappearance-frame-input"
                       value="100"
                       min="0">
                <button id="create-feature-button">Create Feature & Set Active</button>
                <h4>Add to Active Feature</h4>
                <label for="point-id-input">Point ID (optional for new points):</label>
                <input type="text" id="point-id-input" placeholder="p1">
                <p>
                    <em>Sphere Click Coords: <span id="sphere-click-coords">(x: N/A, y: N/A, z: N/A)</span></em>
                </p>
                <button id="add-point-button">Add Point (at current frame, using sphere click coords)</button>
                <button id="add-keyframe-button">Add Keyframe (for Point ID, at current frame, using sphere click coords)</button>
                <hr>
                <h3>Save / Load</h3>
                <button id="save-button" disabled>Save Animation</button>
                <hr>
                <label for="load-id-input">Animation ID to Load:</label>
                <input type="number" id="load-id-input" placeholder="Enter ID (e.g., 1)">
                <button id="load-button">Load Animation</button>
                <hr>
                <div id="status-message-div" class="status-message">App starting...</div>
            </aside>
        </div>
    </body>
</html>
